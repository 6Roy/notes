# 网络层实验


目录
1. ARP分析
2. ICMP分析
3. IP分析
4. 网络层分片实验
5. 静态路由及其配置实验
6. VLAN间通信综合实验
7. 设计型实验

## 1 ARP分析

address resolution protocol
### 原理
[参考计算机网络](../计算机网络/5.3&#32;链路层-交换局域网.md)
物理网络使用硬件地址传输报文，IP地址不能被物理网络识别。建立两种地址的映射关系。将IP地址机械城硬件地址的协议，称为地址解析协议。

ARP是动态协议，过程自动完成。主机有ARP表缓存。

### 同一网段的ARP解析过程
* 查表，没有对方主机MAC地址，广播发送ARP请求报文。
* 目的主机收到请求报文后判断是否在索要自己的MAC地址，若果是，将自己的MAC地址写入应答报文，并发单播回去。
* 主机A收到单播ARP应答报文，将IP-MAC对应关系存入缓存。

### 不同网段的ARP解析过程
* 源主机将报文发送给默认网关，查找解析自己配置的默认网关的IP地址，得到MAC地址，将默认网关IP-MAC存入缓存。
* 由默认网关通过网络层根据路由表寻找下一跳地址，解析吓一跳的IP地址，得到MAC地址，将吓一跳IP-MAC存入缓存。


## 2 ICMP分析
internet control message protocol，因特网控制协议
### 原理
参考[网络层-网际协议](../计算机网络/4.2&#32;网络层-网际协议.md).

允许主机报告差错情况提供有关信息，用于调试、监控网络。

### ICMP报文
略

### ICMP报文分类
差错报文
|类型值|ICMP报文类型|
|-|-|
|3|重点不可达|
|4|源站抑制|
|11|超时|
|12|参数问题|
|5|路由重定向|

询问报文
|类型值|ICMP报文类型|
|-|-|
|8或0|回送请求或应答|
|13或14|时间戳请求或应答|
|17或18|地址掩码请求或应答|
|10或9|路由器询问或通告|

### 基于ICMP的应用程序

* ping
  * 检测网络连通性
  * 确定数据报被丢失、复制或重传。序列号唯一，用来检查结束到的应答报文的序列号。
  * 报文内放置时间戳。分局返回时间计算RTT
  * 校验接收到的数据包，确定数据报是否被损坏
  * ping  -n count 指定ping数量。-i ttl指定生存时间。-s count 指定转发次数。-w timeout指定超时时间ms。

* traceroute
  * 本地计算机到目的主机的路径信息。
  * 发送具有不同TTL的ICMP请求报文，以确定每一跳。
  * tracert -d 指定不对计算机名进行解析。-h maxiumhops指定最大跳。-w timeout指定超时时间ms。

* Pingtest程序
  * 专门用来发送ICMP报文的程序。

```
# 开启tracert命令的应答
ip ttl-expires enable
ip unreachables enable
```
## 3 IP分析

Internet protocol

参考[网络层-网际协议](../计算机网络/4.2&#32;网络层-网际协议.md)。
### IP报文格式
### IP地址编址方式

无分类域间路由选择CIDR

### IP层的路由分析

主机路由过程：将目的地之与子网掩码相与计算网络地址，与自身网络地址对比，不一样，则发往网关路由器。

路由器转发数据报的算法：
1. 从收到的数据包首部提取目的IP地址D。
2. 判断是否直接交付。检测直连网络地址，如果有匹配的网段，直接交付。否则执行3
3. 若路由表中有目的地址为D的特定路由，则将数据传送给路由表中指明的下一跳路由器。否则执行4
4. 对路由表中的每一行进行扫描，将目的地之与每一项的网络地址对比，找到所有的匹配项。
5. 选取所有匹配项的最长网络前缀的路由表项。将数据报传送给表向对应的吓一跳路由器。结束，否则执行下一步。
6. 报告转发分组出错。

路由表的生成方式可以分为静态配置和动态生成两种。静态路由和动态路由。动态生成可以通过OSPF算法和BGP算法实现。

路由器数据报转发总共有四个分支直接交付、特定路由完全匹配下一跳、最长前缀匹配网络号、报告分组转发出错。对应的三种地址分别是直接路由地址（direct）、静态路由地址（static）、动态路由地址（ospf、rip）。

```
# 显示路由表
display ip routing-table

# 启用调试
debugging ppp all
terminal debugging
```
## 4 网络层分片实验

设置以太网端口的MTU实现分片。
```
# 设置mtu
inter ethernet 0/0
mtu 100
ip addr 192.192.192.169 255.255.255.0

# ping
ping -s 300 102.102.169.21
```

## 5 VLAN间通信综合实验

### 原理
VLAN能够隔离二层广播。三层交换机-路由交换机，三层路由模块，实现三层的路由转发；二层交换模块，实现VLAN内的二层转发。用户可以设置默认网关，即VLAN的接口IP地址。

三层路由模块采用了以此路由多次转发的技术。

## 6 设计型实验