数据链路层（以太网协议）：负责两个相邻设备之间的数据帧的传送和识别

一、以太网的帧格式

源地址和目的地址是指网卡的硬件地址（也叫MAC地址），长度是48位（6个字节），是在网卡出厂时固化的。

帧格式类型的字段有三种值，分别对应IP,ARP,RARP.

帧尾是CRC校验码.

二、MAC地址

含义：媒体访问控制，或物理地址，或硬件地址

用途：识别数据链路层中相连的节点。

组成：6个字节，一般用16进制数字加上冒号的形式来表示。（比如：08：00：27：03:fb:19）

在网卡出厂时就确定了，不能修改，mac地址通常是唯一的（虚拟机中的mac地址不是真实的mac地址，可能会冲突，也有些网卡支持用户配置的mac地址）

三、MAC地址和IP地址的比较

IP地址描述的是路途的起点和终点，MAC地址描述的是路途中每一个区间的起点和终点。

四、MTU(最大传输单元)

以太网帧中的数据长度规定最小46字节，最大1500字节，ARP数据包的长度不够46字节，要在后面补填充位。

不同的网络类型有不同的MTU.

如规一个数据包从以太网路由到拨号链路上，数据包长度大于拨号链路的MTU了，则需要对数据包进行分片。

不同的数据链路层的MTU是不同的。

1.MTU对IP协议的影响

将较大的IP包分成多个小包，并给每个小包打上标签。

每个小包IP协议头的16位标识（id）,都是相同的。

每个小包的IP协议头的3未标志字段中，第2位置为0，表示允许分片，第3位来表示结束标记。（当前是否是最后一个包，是为1，否则为0）

到达对端时再将这些小包，会按顺序重组，拼装到一起返回给传输层。

一旦这些这些小包中任意一个小包丢失，接收端的重组就会失败，但是IP层不会负责重新传输数据。

2.MTU对UDP的影响

网络层分包主要对UDP分片

一旦UDP携带的数据超过1472（1500-20(IP首部)-8(UDP首部)），那么就会在网络层分成多个IP数据报。

这多个IP数据报中有任意一个丢失，都会引起接收端网络层重组失败，那么就意味着，如果UDP数据报在网络层被分片，整个数据丢失的概率就大大增加了。

3.MTU对TCP的影响

TCP分包主要在传输层。

TCP的一个数据报也不能无限大，还是受限于MTU,TCP的单个数据报的最大消息长度，称为MSS(Max
Segment Size)

TCP建立连接的时候，通信双方会进行MSS协商

最理想的情况下，MSS的值正好是IP不会被分片处理的最大长度。

双方在发送SYN的时候会在TCP的头部写入自己能支持的MSS值。

然后双方得知对方的MSS之后，选择较小的做为最终的MSS

MSS的值就是在TCP首部的40字节变长选项中（kind=2）

五、ARP协议（地址解析协议）

1.ARP协议的协议格式

2.ARP协议的作用

ARP不是一个单纯的数据链路层的协议，而是一个介于数据链路层和网络层之间的协议。

ARP协议建立了主机IP地址和MAC地址的映射关系。

3.ARP协议的工作流程

源主机发出ARP请求，假如询问“IP地址是192.168.0.1的主机的硬件地址是多少”，并将这个请求广播到本地网段。

目的主机接收到广播的ARP请求，发现其中的IP地址与本机相符，则本机就发送一个ARP应大数据包给源主机，将自己的硬件地址（MAC地址）写在应答包中。

每一台主机都维护一个ARP缓存表，可以用arp
\-a命令来查看，缓存表中的表项有过期时间（一般20分钟），如果过了这个时间，则该表项失效，下次好药发ARP请求来获得目的主机的硬件地址。

六、DNS（Domain Name System）

1.什么是DNS ？

DNS是一整套从域名映射到IP的系统。

2.分布式DNS ?

分布式DNS服务器的特点

安全性：即使根服务器出现问题，分布在下面的DNS解析器还是可以使用的。

速度快：传输的速度快，效率高。

分摊压力：每个DNS都是独立的一部分，它可以帮助根服务器分摊压力。

3.域名简介

域名：用来识别主机名称和主机所属的组织机构的一种分层结构的名称。域名之间用“.”连接。

比如：www.baidu.com

com：一级域名，表示这是一个企业，同级的还有“net”(网络提供商)，“org”(非盈利组织)，“cn”(中国)，“us”(美国）.

baidu：二级域名，公司名

www:只是一种习惯用法。之前人们在使用域名时，往往命名类似于ftp.xxx.xxx/www.xxx.xxx这样的格式，来表示主机支持的协议。

4.域名解析过程

比如：浏览器中输入url之后发生的事情？

分析：https://blog.csdn.net/ZY_20181010/article/details/81698641

七、ICMP协议（网际控制信息协议）---\>网络层协议

1.ICMP的协议格式

2.ICMP协议的功能：

ICMP协议是一种面向无连接的协议

确认IP包是否能成功到达目标地址。

通知在发送过程中IP包被丢弃的原因。

ICMP也是基于IP协议的，所以是网络层协议。

ICMP只能搭配IPv4 使用，如果是IPv6的情况下，需要的用ICMPv6.

1）ping 命令

格式：ping + 域名（不是URL）

ping
命令不光能验证网络的连通性，同时也会统计响应时间和TTL(IP协议中的最大报文生存周期)。

ping命令会先发送一个ICMP Echo Request给对端；对端接收到之后，会返回一个ICMP Echo
Reply;

注意：ping 基于ICMP,在网络层，而端口号是传输层的内容，所以ping 没有端口。

2）traceroute命令

基于ICMP协议实现，能够打印出可执行程序主机，一直到目标主机之间经历多少路由器。

3）NAT IP

在NAT路由器内部，有一张自动生成的，用于地址转换的表。

4）NAPT (使用IP +port来判断将数据包发送给哪个局域网的主机)

5)NAT技术的缺陷

无法从NAT外部向内部服务器建立连接。

转换表的生成和销毁都需要额外开销。

通信过程中一旦NAT设备异常，即使存在热备，所有的TCP连接也会断开。

6）NAT和代理服务器的区别
